<div class="container-service" >
  <p class="search-link"><i class="fas fa-chevron-left"></i><%= link_to 'SEARCH', services_path%></p>
  <div class="service-header">
    <div class="service-title">
      <h1><%= @service.title %></h1>
      <pre><%= @service.user.location %></pre>
    </div>
    <div class="rate-service">
      <span class="iconify"
            data-icon="ant-design:star-filled"
            data-inline="false"
            style="color: #ffc600;font-size: 18px;margin-bottom: 3px;margin-right: 8px;">

      </span>
      <% if @service.average_rating.nil? %>
        0
      <% else %>
        <%= @service.average_rating %>
      <% end %>
      <span class="rating-line">|</span>
      <a href="#service-rev">
        <% if @service.reviews.length == 1 %>
          <u><%= @service.reviews.length %> review</u>
        <% else %>
          <u><%= @service.reviews.length %> reviews</u>
        <% end %>
      </a>
    </div>
  </div>

  <!-- edit and delete only for provider -->
  <%#= link_to edit_service_path(@service) do %>
    <!-- <i class="far fa-edit"></i> -->
  <%# end %>
  <%#= link_to service_path(@service), method: :delete, data: {confirm: 'Are you sure?'} do %>
  <!-- <i class="far fa-trash-alt"></i> -->
  <%# end %>

  <div class="service-content">
    <div class="service-img">
      <% if @service.photos.empty? %>
        <img class="d-block w-75 d-flex justify-content-center" alt="First slide" src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcTtPtBW4Rw0SPkwgxokYqQW4jRJjuEgDDbTM8ULc4zzoHCT4g1j">
      <% else %>
        <%= cl_image_tag @service.photos.first.key, class: "" %>
      <% end %>
      <!-- 2nd+ images -->
      <% i = 1 %>
      <% while i < @service.photos.length %>
        <%= cl_image_tag @service.photos[i].key, class: "" %>
        < % i += 1 %>
      <% end %>
    </div>

    <div class="service-booking">
      <%= render "bookings/form" %>
    </div>
  </div>

  <div class="service-info">
    <h2>Service Description</h2>
    <div class="service-description">
      <p><%= @service.description %></p>
    </div>
    <div class="provider-description">
      <div class="provider-img">
        <%= link_to user_path(@service.user) do %>
          <% if @service.user.photo.attached? %>
            <%= cl_image_tag @service.user.photo.key %>
          <% end %>
        <% end %>
      </div>
      <div class="provider-info">
        <div class="provider-details">
          <%= link_to user_path(@service.user) do %>
            <h2><%= @service.user.first_name %> <%= @service.user.last_name[0] %>.</h2>
          <% end %>
          <h3><%= @service.years_experience %> Years of Experience</h3>
          <p><%= @service.user.description %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- location map -->
  <div class="service-location">
    <h2>Location</h2>
    <pre><%= @service.user.location %></pre>
    <div
      class="result-map"
      id="map"
      style="
        width: 100%;
        height: 50vh;
        border-radius: .25rem;
        "
      data-markers="<%= @marker.to_json %>"
      data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>

  <!-- review section -->

  <div class="service-review" id="service-rev">
    <h2>What people are saying</h2>
    <div class="sum-rating">
      <span class="iconify"
            data-icon="ant-design:star-filled"
            data-inline="false"
            style="color: #ffc600;font-size: 18px;margin-bottom: 3px;margin-right: 8px;">
      </span>
      <% if @service.average_rating.nil? %>
        0
      <% else %>
        <%= @service.average_rating %>
      <% end %>
      <span class="rating-line">|</span>
      <% if @service.reviews.length == 1 %>
        <span><%= @service.reviews.length %> review</span>
      <% else %>
        <span><%= @service.reviews.length %> reviews</span>
      <% end %>
    </div>
    <% @service.reviews.reverse.each do |r| %>
      <div class="review-section">
        <%= link_to user_path(r.user) do %>
          <h6 style="color: black;"><%= r.user.full_name %></h6>
        <% end %>
        <p class="review-date"><%= r.created_at.strftime("%B") %> <%= r.created_at.year %></p>
        <p class="review-rating">
          <% r.rating.times do %>
            <span class="iconify" data-icon="ant-design:star-filled" data-inline="false" style="color: #ffc600"></span>
          <% end %>
        </p>
        <p><%= r.content %></p>
      </div>
    <% end %>
  </div>


  <!-- booking confirmation modal -->

<div class="bg-modal">

  <div id="modal-confirm">
    <h2>Booking Request Sent!</h2>
    <p>Let's wait for <%= @service.user.full_name %>'s response!</p>
    <% if @service.user.photo.attached? %>
      <%= cl_image_tag @service.user.photo.key, height: 300, width: 400, crop: :fill, class: 'smallsize-avatar' %>
    <% else %>
      <%= image_tag "https://cdn.pixabay.com/photo/2016/08/08/09/17/avatar-1577909_960_720.png", class: "smallsize-avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
    <% end %>
    <%= link_to 'Go to Dashboard', dashboard_path, class: 'button' %>

    <div id="closed">+</div>
  </div>
</div>

